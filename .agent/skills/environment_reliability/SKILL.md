---
name: environment_reliability
description: 環境の不安定性やライブラリ導入トラブルを回避し、堅牢な開発を行うためのプロトコル
---

# 環境信頼性プロトコル (Environment Reliability Protocol)

このスキルは、ライブラリのインストール失敗や環境の不安定さが原因で、デバッグが迷走（泥沼化）することを防ぐための指針を定義します。

## 1. 異常の早期検知と判断 (Detecting Environment Issues)

- **インストールの失敗を軽視しない**:
  - `pip` インストール中のフリーズ、タイムアウト、無反応が発生した場合は、そのライブラリを「信頼できない」と即座に判断する。
  - インポートに成功しても、内部的な不整合で挙動が不安定になる可能性がある。

- **「泥沼」の兆候**:
  - 「さっきまで動いていたコードが、ライブラリ追加後に説明のつかないエラーを出す」
  - 「APIキーが無効と言われるが、別環境では動く」
  - これらの場合、ロジックではなく**読み込みレイヤー（環境）**を疑う。

## 2. 依存関係の最小化 (Dependency-Free Fallback)

- **標準ライブラリの優先利用**:
  - 設定ファイルの読み込み（`.env` 等）や単純なデータ処理など、標準ライブラリで代替可能な機能は、外部ライブラリへの依存を避ける。
  - 特に環境が不安定な場合、コードを「ポータブル」にするために自作ローダー（`manual_load`）を採用する。

## 3. 比較検証プロトコル (Comparative Debugging)

- **既知の正常版（Working Base）との比較**:
  - 常に比較対象となる「確実に動く古いバージョン」を手元に残し、挙動を突き合わせる。
  - **直接指定テスト**: 環境変数などを `export` で直接渡し、コード内の読み込みロジックをバイパスしてテストする。これにより「キーの問題」か「読み込みの問題」かを1秒で切り分ける。

## 4. トラブルシューティングの優先順位 (Priority)

1. **環境変数の直接渡し**: ライブラリを介さず値が通るか確認。
2. **依存の排除**: 怪しい外部ライブラリをアンインストールし、自前実装に切り替え。
3. **モデル名・API仕様の再確認**: 1と2をクリアした後に初めて、API側の仕様変更を疑う。

## 5. 迷走を防ぐための行動指針

- 「原因がわからない」状態が15分以上続いたら、一度 **「今追加したライブラリをすべて外して、標準ライブラリだけで同じことができないか」** を検討する。
